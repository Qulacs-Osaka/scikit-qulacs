
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scikit-qulacs チュートリアル &#8212; scikit-qulacs  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Notebooks" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">scikit-qulacs  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../modules.html">
   skqulacs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../skqulacs.html">
     skqulacs package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../skqulacs.circuit.html">
       skqulacs.circuit package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.circuit.circuit.html">
         skqulacs.circuit.circuit module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.circuit.graph.html">
         skqulacs.circuit.graph module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.circuit.pre_defined.html">
         skqulacs.circuit.pre_defined module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../skqulacs.qnn.html">
       skqulacs.qnn package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.qnn.classifier.html">
         skqulacs.qnn.classifier module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.qnn.qnnbase.html">
         skqulacs.qnn.qnnbase module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.qnn.regressor.html">
         skqulacs.qnn.regressor module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../skqulacs.qsvm.html">
       skqulacs.qsvm package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.qsvm.qsvc.html">
         skqulacs.qsvm.qsvc module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../skqulacs.qsvm.qsvr.html">
         skqulacs.qsvm.qsvr module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../skqulacs.typing.html">
       skqulacs.typing module
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Scikit-qulacs チュートリアル
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/0_tutorial.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Qulacs-Osaka/scikit-qulacs"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/Qulacs-Osaka/scikit-qulacs/blob/main/doc/source/notebooks/0_tutorial.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   scikit-qulacs とは
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   インストール
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quantum-neural-network">
   Quantum neural network
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skqulacs-qnn-qnnclassifier">
     <code class="docutils literal notranslate">
      <span class="pre">
       skqulacs.qnn.QNNClassifier
      </span>
     </code>
     の使い方
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skqulacs-qnn-qnnregressor">
     <code class="docutils literal notranslate">
      <span class="pre">
       skqulacs.qnn.QNNRegressor
      </span>
     </code>
     の使い方
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   量子カーネル法
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skqulacs-qsvm-qsvc">
     <code class="docutils literal notranslate">
      <span class="pre">
       skqulacs.qsvm.QSVC
      </span>
     </code>
     の使い方
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skqulacs-qsvm-qsvr">
     <code class="docutils literal notranslate">
      <span class="pre">
       skqulacs.qsvm.QSVR
      </span>
     </code>
     の使い方
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   用意されている量子回路
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   ユーザー定義の量子回路を学習に利用する
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="scikit-qulacs">
<h1>Scikit-qulacs チュートリアル<a class="headerlink" href="#scikit-qulacs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>scikit-qulacs とは<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>量子回路シミュレータ <a class="reference external" href="https://github.com/Qulacs-Osaka/qulacs-osaka">Qulacs-Osaka</a> (<a class="reference external" href="https://github.com/qulacs/qulacs">Qulacs</a> の大阪大学バージョン) をバックエンドとした量子機械学習アルゴリズムのシミュレータです。scikit-learn の名前をもじっています。</p>
</div>
<div class="section" id="id2">
<h2>インストール<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Pypi 経由でインストールできるように準備中です。現在はできないので、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">Qulacs</span><span class="o">-</span><span class="n">Osaka</span><span class="o">/</span><span class="n">scikit</span><span class="o">-</span><span class="n">qulacs</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">scikit</span><span class="o">-</span><span class="n">qulacs</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
<p>としてインストールします。</p>
<p>もうすぐPypi経由でのインストールができると思います。</p>
</div>
<div class="section" id="quantum-neural-network">
<h2>Quantum neural network<a class="headerlink" href="#quantum-neural-network" title="Permalink to this headline">¶</a></h2>
<p>入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> に対して、学習パラメータ <span class="math notranslate nohighlight">\({\boldsymbol \theta}\)</span> を使って
$<span class="math notranslate nohighlight">\(y_{{\boldsymbol \theta}}({\boldsymbol x}) = \langle 0|U^\dagger({\boldsymbol \theta}, {\boldsymbol x}) O U({\boldsymbol \theta}, {\boldsymbol x})|0\rangle\)</span><span class="math notranslate nohighlight">\( 
の形でモデル \)</span>y_{{\boldsymbol \theta}}({\boldsymbol x})$ を構築する手法を量子ニューラルネットワークと呼びます。scikit-qulacs では <code class="docutils literal notranslate"><span class="pre">skqulacs.qnn</span></code> モジュールに実装されています。分類問題をとく <code class="docutils literal notranslate"><span class="pre">skqulacs.qnn.classifier</span></code> と回帰問題を解く <code class="docutils literal notranslate"><span class="pre">skqulacs.qnn.regressor</span></code> の２つがあります。</p>
<div class="section" id="skqulacs-qnn-qnnclassifier">
<h3><code class="docutils literal notranslate"><span class="pre">skqulacs.qnn.QNNClassifier</span></code> の使い方<a class="headerlink" href="#skqulacs-qnn-qnnclassifier" title="Permalink to this headline">¶</a></h3>
<p>例として、有名な <code class="docutils literal notranslate"><span class="pre">iris</span></code> データセットを分類する量子ニューラルネットワークを組んでみます。まず、以下のコードによって <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> から <code class="docutils literal notranslate"><span class="pre">iris</span></code> データセットを取り出し、訓練データとテストデータに分けます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">iris</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;petal length (cm)&quot;</span><span class="p">,</span> <span class="s2">&quot;petal width (cm)&quot;</span><span class="p">]]</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>変数はそれぞれ</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x_train</span></code>: 訓練データの入力</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: 訓練データのラベル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x_test</span></code>: テストデータの入力</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: テストデータのラベル</p></li>
</ul>
<p>です。</p>
<p>次に簡単な量子回路によってこれらの分類を行ってみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skqulacs.circuit.pre_defined</span> <span class="kn">import</span> <span class="n">create_qcl_ansatz</span>
<span class="kn">from</span> <span class="nn">skqulacs.qnn</span> <span class="kn">import</span> <span class="n">QNNClassifier</span>

<span class="n">nqubit</span> <span class="o">=</span> <span class="mi">5</span>                      <span class="c1"># qubitの数。必要とする入力、出力の次元数以上が必要である。</span>
<span class="n">c_depth</span> <span class="o">=</span> <span class="mi">3</span>                     <span class="c1"># circuitの深さ。ニューラルネットワークでの隠れ層に対応する。</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="mf">1.</span>                  <span class="c1"># qcl_ansatz に必要となるパラメータ。横磁場イジングモデルによって発展させる時間を決める。</span>
<span class="n">num_class</span> <span class="o">=</span> <span class="mi">3</span>                   <span class="c1"># 分類数（ここでは3つの品種に分類）</span>
<span class="n">solver</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span>                   <span class="c1"># アルゴリズム。ほかには、&quot;Adam&quot; が使える。</span>
<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">20</span>                    <span class="c1"># ループの最大。これが多いほど、正確になるが、時間がかかる。</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">create_qcl_ansatz</span><span class="p">(</span><span class="n">nqubit</span><span class="p">,</span> <span class="n">c_depth</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>     <span class="c1"># LearningCircuitを作る</span>
<span class="n">qcl</span> <span class="o">=</span> <span class="n">QNNClassifier</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">num_class</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span>     <span class="c1"># モデル構築を行う</span>
<span class="n">opt_loss</span><span class="p">,</span> <span class="n">opt_params</span> <span class="o">=</span> <span class="n">qcl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">)</span>                          <span class="c1"># 学習</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trained parameters&quot;</span><span class="p">,</span> <span class="n">opt_params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">opt_loss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2564</span><span class="o">/</span><span class="mf">2652384445.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">skqulacs.circuit.pre_defined</span> <span class="kn">import</span> <span class="n">create_qcl_ansatz</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">skqulacs.qnn</span> <span class="kn">import</span> <span class="n">QNNClassifier</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">nqubit</span> <span class="o">=</span> <span class="mi">5</span>                      <span class="c1"># qubitの数。必要とする入力、出力の次元数以上が必要である。</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">c_depth</span> <span class="o">=</span> <span class="mi">3</span>                     <span class="c1"># circuitの深さ。ニューラルネットワークでの隠れ層に対応する。</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;skqulacs&#39;
</pre></div>
</div>
</div>
</div>
<p>テストデータと比べて結果を出力します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">qcl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9473684210526315
</pre></div>
</div>
</div>
</div>
<p>うまく分類できていることがわかります。</p>
</div>
<div class="section" id="skqulacs-qnn-qnnregressor">
<h3><code class="docutils literal notranslate"><span class="pre">skqulacs.qnn.QNNRegressor</span></code> の使い方<a class="headerlink" href="#skqulacs-qnn-qnnregressor" title="Permalink to this headline">¶</a></h3>
<p>回帰問題を解くには <code class="docutils literal notranslate"><span class="pre">QNNRegressor</span></code> を使います。ここでは <span class="math notranslate nohighlight">\(y=\sin(\pi x)\)</span> を学習させてみます。まずデータセットを作ります。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="k">def</span> <span class="nf">generate_noisy_sine</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_x</span><span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="p">[[</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_x</span><span class="p">)]</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_train</span><span class="p">]</span>
    <span class="n">mag_noise</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">y_train</span> <span class="o">+=</span> <span class="n">mag_noise</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">num_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span>
  
<span class="n">x_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">num_x</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_noisy_sine</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_x</span><span class="p">)</span>
<span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_noisy_sine</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>作成したデータに対して学習を行います。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skqulacs.qnn</span> <span class="kn">import</span> <span class="n">QNNRegressor</span>

<span class="n">n_qubit</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">depth</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">solver</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span>
<span class="n">maxiter</span><span class="o">=</span><span class="mi">20</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">create_qcl_ansatz</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qnn</span> <span class="o">=</span> <span class="n">QNNRegressor</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">solver</span><span class="p">)</span>
<span class="n">opt_loss</span><span class="p">,</span> <span class="n">opt_params</span> <span class="o">=</span> <span class="n">qnn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trained parameters&quot;</span><span class="p">,</span> <span class="n">opt_params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">opt_loss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-2.52118172e-03  1.19277020e-03  3.10128326e-04 -6.42683364e-04
  8.35436474e-04 -5.24981892e-04 -7.52008036e-04 -4.07462371e-04
 -5.74044155e-04  1.50774930e-03  6.30109294e-05 -8.19459615e-04
  1.42078707e-03  2.09110696e-03 -3.36846534e-04  4.88690753e-04
  7.46908451e-05 -2.22482857e-04 -9.25977438e-04 -9.12545452e-05
  1.04324965e-03 -5.63038944e-04 -4.62934646e-04 -3.62787336e-04
 -8.51174859e-04  2.90978510e-03  1.96177705e-03  6.80510436e-05
  1.69540322e-04  3.45813053e-04  3.20652348e-04 -2.24440888e-04
 -5.65850928e-05 -7.10191967e-04  5.10276819e-04  7.51022395e-04
  1.50621087e-03 -1.01846464e-03 -8.74319743e-04  3.54710895e-17
  3.59299055e-17  3.59218882e-17  3.58373194e-17  3.59945889e-17
  3.55306677e-17  3.67906416e-17  3.59392206e-17  3.58473687e-17]
trained parameters [ 4.76002724  1.92362022 -0.48900136  0.35047068  4.82948963  6.46225974
  3.40609952  5.00474857  3.37636039  6.31050608  5.49376378  0.139052
  5.47590209  0.64912218  4.67870237  1.41841969  5.53849844  3.7883166
  1.84668854  2.68946397  0.04043366  0.96776472  4.49352776  3.60008095
  3.88877639  2.58504726  6.23553393  6.16278554  4.24511007  3.92287119
  4.33309344  2.56906654  0.6973149   4.8681623   3.38829756  1.61272237
  3.30808541  5.46822145  5.94478902  2.24809352  3.59102784  2.02236503
  3.73409722  2.12315885  2.46061475  5.59375873  1.42727325  3.91560031]
loss 0.008518100629961275
</pre></div>
</div>
</div>
</div>
<p>訓練したモデルとテストデータを並べてプロットしてみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">qnn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0_tutorial_16_0.png" src="../_images/0_tutorial_16_0.png" />
</div>
</div>
<p>よく学習できていることがわかります。</p>
</div>
</div>
<div class="section" id="id3">
<h2>量子カーネル法<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> を量子状態 <span class="math notranslate nohighlight">\(|\psi({\boldsymbol x})\rangle\)</span> にマップし、この量子状態間の内積で定義されるカーネル関数
$<span class="math notranslate nohighlight">\(K({\boldsymbol x},{\boldsymbol x}')=|\langle \psi({\boldsymbol x})| \psi({\boldsymbol x}')\rangle|^2\)</span>$
を使ったカーネル法を量子カーネル法と呼びます。scikit-qulacs には、support vector classifier <code class="docutils literal notranslate"><span class="pre">skqulacs.qsvm.QSVC</span></code> と support vector regressor <code class="docutils literal notranslate"><span class="pre">skqulacs.qsvm.QSVR</span></code> の2つが実装されています。</p>
<div class="section" id="skqulacs-qsvm-qsvc">
<h3><code class="docutils literal notranslate"><span class="pre">skqulacs.qsvm.QSVC</span></code> の使い方<a class="headerlink" href="#skqulacs-qsvm-qsvc" title="Permalink to this headline">¶</a></h3>
<p>ここでは IBM のグループが論文 <a class="reference external" href="https://www.nature.com/articles/s41586-019-0980-2">Supervised learning with quantum-enhanced feature spaces</a> で提案した <span class="math notranslate nohighlight">\(|\psi({\boldsymbol x})\rangle\)</span> を使った分類を行います。この状態を作る量子回路は <code class="docutils literal notranslate"><span class="pre">skqulacs.circuit.create_ibm_embedding_circuit</span></code> によって作り出せます。</p>
<p>まずデータセットを準備します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">iris</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;petal length (cm)&quot;</span><span class="p">,</span> <span class="s2">&quot;petal width (cm)&quot;</span><span class="p">]]</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>回路を作成し、QSVC を訓練、予測値を出力させます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skqulacs.circuit</span> <span class="kn">import</span> <span class="n">create_ibm_embedding_circuit</span>
<span class="kn">from</span> <span class="nn">skqulacs.qsvm</span> <span class="kn">import</span> <span class="n">QSVC</span>
<span class="n">n_qubit</span> <span class="o">=</span> <span class="mi">4</span>                         <span class="c1"># x_train の次元数以上必要。あまり小さいと結果が悪くなる。</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">create_ibm_embedding_circuit</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">)</span>
<span class="n">qsvm</span> <span class="o">=</span> <span class="n">QSVC</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
<span class="n">qsvm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">qsvm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>評価してみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8978070175438595
</pre></div>
</div>
</div>
</div>
<p>qnn よりも悪い結果となりました。回路形がこのデータセットに適していないからだと考えられます。</p>
</div>
<div class="section" id="skqulacs-qsvm-qsvr">
<h3><code class="docutils literal notranslate"><span class="pre">skqulacs.qsvm.QSVR</span></code> の使い方<a class="headerlink" href="#skqulacs-qsvm-qsvr" title="Permalink to this headline">¶</a></h3>
<p>同様の回路を使い、回帰を行ってみます。QNN の場合と同様に、<span class="math notranslate nohighlight">\(\sin(\pi x)\)</span> を学習します。まずデータセットを作ります。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">num_x</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_noisy_sine</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_x</span><span class="p">)</span>
<span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_noisy_sine</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>学習します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skqulacs.qsvm</span> <span class="kn">import</span> <span class="n">QSVR</span>
<span class="n">n_qubit</span> <span class="o">=</span> <span class="mi">4</span>                         <span class="c1"># x_train の次元数以上必要。あまり小さいと結果が悪くなる。</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">create_ibm_embedding_circuit</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">)</span>
<span class="n">qsvm</span> <span class="o">=</span> <span class="n">QSVR</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
<span class="n">qsvm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">qsvm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>学習結果をプロットしてみます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0_tutorial_31_0.png" src="../_images/0_tutorial_31_0.png" />
</div>
</div>
<p>うまく学習できています。</p>
</div>
</div>
<div class="section" id="id4">
<h2>用意されている量子回路<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>scikit-qulacs では代表的な論文で発表されている機械学習用量子回路を手軽に使えるようにするため、量子回路の実装に努めています。機械学習用量子回路は <code class="docutils literal notranslate"><span class="pre">LearningCircuit</span></code> クラスのインスタンスとして実装されていて、<code class="docutils literal notranslate"><span class="pre">skqulacs.circuit</span></code> モジュールにある <code class="docutils literal notranslate"><span class="pre">create_...()</span></code> という関数を呼ぶことにより作成可能です。</p>
<p>現在、</p>
<ul class="simple">
<li><p>create_qcl_ansatz(n_qubit: int, c_depth: int, time_step: float, seed=None): <a class="reference external" href="https://arxiv.org/abs/1803.00745">arXiv:1803.00745</a></p></li>
<li><p>create_farhi_neven_ansatz(n_qubit: int, c_depth: int, seed: Optional[int] = None): <a class="reference external" href="https://arxiv.org/pdf/1802.06002">arXiv:1802.06002</a></p></li>
<li><p>create_farhi_neven_watle_ansatz(n_qubit: int, c_depth: int, seed: Optional[int] = None): 上記回路を &#64;WA_TLE さんが改良したもの。</p></li>
<li><p>create_ibm_embedding_circuit(n_qubit: int): <a class="reference external" href="https://arxiv.org/abs/1804.11326">arXiv:1804.11326</a></p></li>
<li><p>create_shirai_ansatz(n_qubit: int, c_depth: int = 5, seed: int = 9): <a class="reference external" href="http://arxiv.org/abs/2111.02951">aeXiv:2111.02951</a>
注:微妙に細部が異なる可能性あり</p></li>
</ul>
<p>が用意されています。</p>
<p>基本的には <code class="docutils literal notranslate"><span class="pre">QNNClassifier</span></code> などの引数として与えることを推奨しますが、自前で新たなアルゴリズムを作りたいときなど、これらの量子回路を直接扱いたいときもあると思います。以下に使用例を掲載します。</p>
<p>以下のコードで QCL ansatz を作成します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_qubits</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">c_depth</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">ansatz</span> <span class="o">=</span> <span class="n">create_qcl_ansatz</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">,</span> <span class="n">c_depth</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">LearningCircuit</span></code> にセットされている訓練パラメータは <code class="docutils literal notranslate"><span class="pre">get_parameters()</span></code> によって取り出せます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">),</span> <span class="n">parameters</span><span class="p">)</span>      <span class="c1"># show parameters in the circuit. Parameters are chosen randomly within create_qcl_ansatz()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>48 [0.7238575654756965, 4.521772018945494, 5.300166829620294, 2.4396786706992875, 3.372497641445515, 0.0691143830945458, 2.4305919508432194, 0.897581496914585, 0.8153164989629146, 4.19580716083789, 4.614797622397918, 2.951713965321396, 2.449149087341643, 2.4619419636304105, 1.0029754525418129, 2.334478387370933, 2.5589036813723762, 4.50591651911791, 4.486222509952132, 1.559585289816079, 6.164351024607971, 1.47322926380012, 2.0729721326039914, 2.275646680431729, 2.9195023453638385, 2.7015553984398526, 5.814853292230643, 5.161654841481886, 0.7527848104233957, 1.728308187107492, 5.360006969176836, 5.201498343709625, 0.42675480228093243, 1.967788806417369, 1.7897854085117577, 5.321631318940725, 5.6122834079775785, 5.437876706508988, 2.4878547042811134, 3.796733572414534, 0.9677624343101473, 1.8208670050419042, 0.4657427370080585, 5.820313505901443, 1.2863802672251754, 2.4653914032427604, 0.3882421258541333, 1.4073421893586033]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">update_parameters()</span></code> を使うと、パラメータを更新できます。以下では全てのパラメータをゼロにセットします。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ansatz</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ansatz</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">run(x)</span></code> を使うと、入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> に対して、初期状態 <span class="math notranslate nohighlight">\(|0\rangle\)</span> に量子回路を作用させたときの出力状態が <code class="docutils literal notranslate"><span class="pre">qulacs.QuantumState</span></code> として返されます。QCL ansatz は <code class="docutils literal notranslate"><span class="pre">n_qubits</span></code> 次元までの入力を扱うことのできる ansatz なので、今回は 2 次元入力を与えます。</p>
<p>多くの回路では、データ次元数をaとして、それが<code class="docutils literal notranslate"><span class="pre">n_qubits</span></code>以下の場合、回路のx番目には、n_qubits % a 番目の入力が入ります。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get_vector</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.30869612+0.13283004j -0.0759879 -0.06176279j -0.21316566-0.1438611j
  0.21877642+0.06614673j -0.33638863+0.12504632j  0.24610584+0.23178805j
  0.05948781+0.05711437j  0.03556247-0.08914448j  0.03556247-0.08914448j
  0.05948781+0.05711437j  0.24610584+0.23178805j -0.33638863+0.12504632j
  0.21877642+0.06614673j -0.21316566-0.1438611j  -0.0759879 -0.06176279j
  0.30869612+0.13283004j]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>ユーザー定義の量子回路を学習に利用する<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>ここでは自分でオリジナルの量子回路を定義し、それを学習に利用する方法を説明します。scikit-qulacs では、<code class="docutils literal notranslate"><span class="pre">LearningCircuit</span></code> クラスによって量子回路を表現しています。これは qulacs の <code class="docutils literal notranslate"><span class="pre">ParametricQuantumCircuit</span></code> のラッパーとなっていて、入力データと訓練される回路パラメータを一元管理し、それらをすべて qulacs の parametric gate で扱えるようにしたものです。</p>
<p><code class="docutils literal notranslate"><span class="pre">LearningCircuit</span></code> クラスは qulacs の <code class="docutils literal notranslate"><span class="pre">ParametricQuantumCircuit</span></code> のうちの主要な <code class="docutils literal notranslate"><span class="pre">add_.._gate()</span></code> 系のメソッドを機能そのままにラップしています。それに加えて、<code class="docutils literal notranslate"><span class="pre">ParametricQuantumCircuit</span></code> を拡張する機能として、以下のメソッドが追加されています。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_input_RX_gate(index,</span> <span class="pre">input_func)</span></code>, <code class="docutils literal notranslate"><span class="pre">add_input_RY_gate(index,</span> <span class="pre">input_func)</span></code>, <code class="docutils literal notranslate"><span class="pre">add_input_RZ_gate(index,</span> <span class="pre">input_func)</span></code>: 入力データを入れるためのゲートを追加します。引数にはそれぞれ以下のものを与えます。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>: そのゲートを作用させる量子ビット</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_func</span></code>: 入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> -&gt; 回転ゲートの回転角 <span class="math notranslate nohighlight">\(\phi = \phi({\boldsymbol x})\)</span> の変換を行う関数。回路実行時には <code class="docutils literal notranslate"><span class="pre">input_func(x)</span></code> が角度にセットされます。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_parametric_input_RX_gate(index,</span> <span class="pre">parameter,</span> <span class="pre">input_func)</span></code> (RY, RZ も同様) :入力データと訓練パラメータが同時に含まれているようなゲートを追加します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>: そのゲートを作用させる量子ビット</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameter</span></code>: 実数の訓練パラメータ <span class="math notranslate nohighlight">\(\theta\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_func</span></code>: 入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span>, 訓練パラメータ <span class="math notranslate nohighlight">\(\theta\)</span> -&gt; 回転ゲートの回転角 <span class="math notranslate nohighlight">\(\phi = \phi(\theta, {\boldsymbol x})\)</span> の変換を行う関数。回路実行時には <code class="docutils literal notranslate"><span class="pre">input_func(theta,</span> <span class="pre">x)</span></code> が角度にセットされます。</p></li>
</ul>
</li>
</ul>
<p>例えば以下のコードは、各量子ビットに <span class="math notranslate nohighlight">\({\boldsymbol x} = \{x_i\}_{i=0}^3\)</span> の各成分を <span class="math notranslate nohighlight">\(R_y\)</span> ゲートで入力したあと、各量子ビットを訓練可能な <span class="math notranslate nohighlight">\(R_y\)</span> ゲートで変換し、最後に全ての量子ビットにアダマールゲートを一度だけ作用させる <code class="docutils literal notranslate"><span class="pre">LearningCircuit</span></code> を構成するコードです。(例のためだけに書いていて、特に意味は無い回路です。)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skqulacs.circuit</span> <span class="kn">import</span> <span class="n">LearningCircuit</span>
<span class="n">n_qubit</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">LearningCircuit</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">):</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">add_input_RY_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="k">2</span>])  # input 2 dimensional x into the circuit by RY rotation
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">):</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">add_parametric_RY_gate</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>           <span class="c1"># first argument is qubit index, second argument is parameter</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">):</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">add_H_gate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">run()</span></code> メソッドによって初期状態 <span class="math notranslate nohighlight">\(|0\rangle\)</span> にこの回路を作用させたときの量子状態が返されます。このメソッドは入力データ <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> を引数として取ります。上の回路は 2 次元の <span class="math notranslate nohighlight">\({\boldsymbol x}\)</span> を取れるように設計したので、2次元の入力を与えます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get_vector</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-6.93889390e-18+0.j -1.96261557e-17+0.j -2.08166817e-17+0.j
 -2.77555756e-17+0.j -2.08166817e-17+0.j  1.96261557e-17+0.j
 -6.93889390e-18+0.j  0.00000000e+00+0.j -2.08166817e-17+0.j
  1.96261557e-17+0.j -6.93889390e-18+0.j  2.77555756e-17+0.j
 -6.93889390e-18+0.j  5.88784672e-17+0.j  9.02056208e-17+0.j
  1.00000000e+00+0.j]
</pre></div>
</div>
</div>
</div>
<p>予想どおりの出力が得られることが確認できます。</p>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Notebooks</p>
        </div>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Qulacs-Osaka<br/>
        
            &copy; Copyright 2021, Qulacs-Osaka.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>